
## 6.1. 백업 계획 

```
이 섹션에서는 Neo4j 데이터베이스에서 백업하는 방법을 소개합니다.
```

Neo4j 데이터베이스를 먼 곳이나 오프라인 저장소로 백업하는 것은 데이터베이스 작동의 기본입니다. 

백업 전략은 특정 요구 사항을 고려하여 설계해야 합니다. 요구 사항에는 성능별 요구 사항과 네트워크 또는 하드웨어 장애 운영 정지 시간 및 데이터 손실 오차 범위가 포함될 수 있습니다.

백업은 데이터베이스 서버에서 로컬로 수행되거나 다른 곳에서 네트워크로 작업할 수 있습니다. 네트워크로 백업을 수행하려면 백업하는 기계에 Neo4j가 반드시 설치되어 있어야 합니다.

### 6.1.1. 온라인 및 오프라인 백업 
 
일반적으로 온라인 백업은 생산 환경에서 쓰이지만 오프라인 백업에 사용할 수도 있습니다. 

오프라인 백업은 데이터베이스를 백업할 때 조금 더 제한적 입니다. 예를들어:

- 온라인 백업은 실제 Neo4j 인스턴스에서 실행하지만 오프라인 백업에는 데이터베이스가 종료되어 있어야 합니다. 
- 온라인 백업은 전체 또는 점차적으로 백업할 수 있지만, 오프라인 백업에서는 점차적으로 백업할 수 없습니다. 

오프라인 백업과 관련된 자세한 사항은 [섹션 10.7, 덤프 및 로드 데이터베이스](//tools/dump-load.md)를 참조하십시오. 

### 6.1.2. 저장소 설정 

백업할 때 공통 종속성이 없는 생산 시스템과는 별도로 데이터를 저장하는 것이 중요합니다. 

클러스터 서버 외부의 다른 (네트워크가 부착된) 저장소 및 선호하는 저장소에 안전하게 백업을 유지하는 것을 권장합니다. 예를 들어, 클라우드에서는 같은 클라우드 내 다른 이용가능한 영역을 사용하거나 별도 클라우드를 사용합니다. 

백업은 오래 유지되기 때문에, 백업 저장 시 보관 장치 수명을 고려해야 합니다. 

### 6.1.3. 네트워크 설정 

백업 클라이언트는 두 가지 별개 프로토콜을 사용할 수 있습니다:

- 핵심 서버 또는 읽기 복제본 중 하나인 [Causal 클러스터](/clustering.md)멤버의 백업은 [*catchup protocol*](/clustering/lifecycle.md)을 사용합니다. 
- 단일 인스턴스 서버 및 [고-가용 클러스터](./ha-cluster.md) 백업은 *공통 백업 프로토콜*을 사용합니다. 

백업 클라이언트는 어떤 서버가 백업할지 사전에 알지 못하기 때문에 먼저 캐치업 프로토콜을 시도합니다. 성공하지 못하면 일반 백업 프로토콜을 시도합니다. 이를 통제하려면, 백업을 수행할 때 ```--protocol```옵션을 사용할 수 있습니다. 

### 6.1.4. 암호화 백업

암호화 백업은 Casual 클러스터로할 수 있습니다.

백업을 실행하는 서버와 백업 대상 모두 동일한 [SSL 정책](/security/ssl-framework.md)으로 구성해야 합니다. 이것은 일반 클러스터 트래픽 ([섹션 4.6, “Intra-cluster 암호화”](/clustering/intra-cluster-encryption.md) 참조) 또는 별도의 클러스터 트래픽 암호화에 사용되는 것과 동일합니다. 백업 트래픽을 암호화할 때 사용되는 정책은 환경 설정 ```dbms.backup.ssl_policy```을 이용해서 양 서버에 할당해야 합니다. 

### 6.1.5. 메모리 환경설정 

백업 프로그램이 시작되면, 새로운 Java 프로세스를 시작할 것 입니다. 실행 중인 Neo4j 데이터베이스가 있다면, Neo4j와 병행하여 실행됩니다. 생산 시스템에서 Neo4j는 일반적으로 시스템의 이용가능한 RAM을 최대로 활용하도록 구성됩니다. 프로덕션 시스템에서 백업을하면 전체 성능에 안좋은 영향을 줄 수 있으며 메모리 부족 오류가 발생할 수도 있습니다. 그렇기 때문에 프로덕션 서버보다는 다른 서버에서 백업할 것을 권장합니다. 

Casual 클러스터를 실행하는 경우, 복제본 읽기에서 백업을 실행할 수도 있습니다. 이와 관련된 상세한 내용은 [섹션 4.5, 백업 계획](/clustering/backup-planning.md)을 참조하면 됩니다.

별도의 백업 서버를 사용할 수 없다면, 백업 프로세스에 어느 정도 메모리를 사용할지 명시함으로써 생산 시스템을 통제할 수 있습니다. 

**백업을 위한 힙(heap) 사이즈 설정**

이것은 백업 프로그램을 시작하기 전에 환경 변수 `HEAP_SIZE`를 설정하여 수행됩니다. ```HEAP_SIZE```에서 명시되지 않는다면, Java 가상 머신이 서버 리소스 기반으로 값을 선택할 것 입니다. ```HEAP_SIZE```는 백업 프로세스에 할당 된 최대 힙(heap) 사이즈를 구성합니다. 

**백업을 위한 페이지 캐시 구성**

페이지 캐쉬 사이즈는 ```neo4j-admin backup``` 명령에 ```--pagecache``` 옵션을 사용하여 백업 프로그램을 결정할 수 있습니다. 정의하지 않을 경우, 페이지 캐시는 8MB로 기본 설정 됩니다. 

Neo4j를 단독으로 사용하거나 고-가용 클러스터를 사용할 경우 다른 서버에서 백업할 것을 권장합니다. 

### 6.1.6. 캐쥬얼 클러스터에서 백업할 때 고려 사항

전체 또는 증가하는 백업은 읽기 복제와 같이 핵심 서버에서 실행할 수 있습니다. 

캐쥬얼 클러스터에서 백업 계획 시 고려 사항은 [섹션 4.5, 백업 계획](/clustering/backup-planning.md)을 참조하십시오. 

[섹션 6.1.3, 네트워크 고려 사항](/backup/backup-introduction.md)에서 설명된 것과 같이 동일한 프로토콜은 읽기 복제를 Casual 클러스터 내 최신으로 유지하고 백업할 때 사용됩니다. 그렇기 때문에 Casual 클러스터에서 ```causal_clustering.transaction_listen_address```의 서버를 보호하는 것은 중요합니다. 