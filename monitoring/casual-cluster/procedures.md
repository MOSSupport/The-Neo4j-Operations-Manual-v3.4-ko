
## 8.4.1 인과 관계 클러스터 모니터링 절차 

```
이 섹션에서는 Neo4j 인과관계 클러스터를 모니터링하는 절차에 대해 다룹니다.
```

클러스터 관련 정보를 제공하는 많은 프로시저를 이용할 수 있습니다. 이 섹션은 아래 내용을 다룹니다. 

- 클러스터 멤버 역할 발견 
- 클러스터 내 인스턴스 개요 얻기 
- 라우팅 추천 받기


#### 8.4.1.1. 클러스터 멤버 역할 찾기 

```dbms.cluster.role()``` 절차는 인과 관계 클러스터의 모든 인스턴스에서 인스턴스 역할을 반환하도록 호출합니다. 

**구문:**

```CALL dbms.cluster.role()```

**반환 값:**

| 이름   | 종류   | 설명                                                         |
| ------ | ------ | ------------------------------------------------------------ |
| `role` | String | 이것은 현재 인스턴스의 역할이며, 다음과 같습니다 `LEADER`, `FOLLOWER`, 또는 `READ_REPLICA`. |

**고려 사항:**

- 이 절차는 그 자체로 유용하지만, 모니터링 절차 기반으로 더욱 유용합니다. 
 
**예 8.10. 이 인스턴스의 역할 확인**

다음 예제에서는 현재 인스턴스 역할을 찾는 방법을 보여줍니다. 이 경우에는 ```FOLLOWER```입니다.

```
CALL dbms.cluster.role()
```


| 역할     |
| -------- |
| FOLLOWER |


#### 8.4.1.2. 클러스터 내 인스턴스 개요 얻기 

```dbms.cluster.overview()``` 절차는 클러스터 모든 인스턴스에 대한 세부 정보를 반환하여 클러스터 토플러지에 대한 개요를 제공합니다. 

**구문:**

```
CALL dbms.cluster.overview()
```

**반환 값:**

| 이름        | 유형         | 설명                                                         |
| ----------- | ------------ | ------------------------------------------------------------ |
| `id`        | String       | 이것은 인스턴스의 id입니다.                                  |
| `addresses` | List<String> | 이것은 모든 인스턴스 주소 리스트입니다.                      |
| `role`      | String       | 이것은 `LEADER`, `FOLLOWER`, or `READ_REPLICA`가 될 수 있는, 인스턴스 역할 입니다. |
| `groups`    | List<String> | 이것은 인스턴스 일부가될 수 있는 모든 서버 리스트 입니다.    |
| `database`  | String       | 이것은 인스턴스가 호스팅하는 데이터베이스의 이름입니다.      |

**고려 사항**

- 이 절차는 클러스터만이 전체 개요 정보를 가지고 있기 때문에 코어 인스턴스에서만 호출됩니다. 
- "database" 필드는 다중-클러스터를 배포하지 않는 한 항상 "default" 값을 가질 것 입니다. 

**예 8.11. 클러스터 개요 얻기**

아래 예는 클러스터 토플러지를 탐색하는 방법을 보여줍니다. 

```
CALL dbms.cluster.overview()
```

| id                                   | 주소                                                       | 역할         | 그룹 | 데이터베이스 |
| ------------------------------------ | ---------------------------------------------------------- | ------------ | ---- | ------------ |
| 08eb9305-53b9-4394-9237-0f0d63bb05d5 | [bolt://neo20:7687, http://neo20:7474, https://neo20:7473] | LEADER       | []   | default      |
| cb0c729d-233c-452f-8f06-f2553e08f149 | [bolt://neo21:7687, http://neo21:7474, https://neo21:7473] | FOLLOWER     | []   | default      |
| ded9eed2-dd3a-4574-bc08-6a569f91ec5c | [bolt://neo22:7687, http://neo22:7474, https://neo22:7473] | FOLLOWER     | []   | default      |
| 00000000-0000-0000-0000-000000000000 | [bolt://neo34:7687, http://neo34:7474, https://neo34:7473] | READ_REPLICA | []   | default      |
| 00000000-0000-0000-0000-000000000000 | [bolt://neo28:7687, http://neo28:7474, https://neo28:7473] | READ_REPLICA | []   | default      |
| 00000000-0000-0000-0000-000000000000 | [bolt://neo31:7687, http://neo31:7474, https://neo31:7473] | READ_REPLICA | []   | default      |

#### 8.4.1.3. 라우팅 추천 받기

어플리케이션 관점으로 볼 때, 클러스터 내 멤버 역할을 아는 것은 놀랍지 않습니다. 대신 어플리케이션은 어떤 인스턴스가 원하는 서비스를 제공하는지 알아야 합니다. 프로시저 ```dbms.cluster.routing.getServers()``` 는 이 정보를 제공합니다. 

**구문:**

```CALL dbms.cluster.routing.getServers()```

**예시 8.12. 라우팅 추천 받기**

아래 예는 클러스터 내에 어떤 인스턴스가 서비스를 제공할 수 있는지 보여줍니다. 

```
CALL dbms.cluster.routing.getServers()

```

이 절차는 특정 서비스 ```READ```, ```WRITE```, ```ROUTE``` 사이의 지도 및 이 서비스를 제공하는 인스턴스 주소를 리턴합니다. 또한 TTL(Time To Live) 정보를 반환합니다. 

결과는 주로 사람이 소비하는 것이 아닙니다. 이것을 확장하면 다음과 같습니다. 

```
ttl: 300,
server: [
{
    addresses: [neo20:7687],
    role: WRITE
}, {
    addresses: [neo21:7687, neo22:7687, neo34:7687, neo28:7687, neo31:7687],
    role: READ
}, {
    addresses: [neo20:7687, neo21:7687, neo22:7687],
    role: ROUTE
}
]
```
