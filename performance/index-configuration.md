## 9.2. 인덱스 환경 설정

```
이 섹션에서는 인덱스 제공자를 설정하는 방법에 대해 다룹니다. 
```

Neo4j는 인덱싱 기능을 이용하기 위해서 네이티브 인덱스와 [Apache Lucene](https://lucene.apache.org/) 결합을 사용합니다. 

### 9.2.1. 네이티브(Native) 인덱스 

성능 상 이유로, 가능할때마다 네이티브 인덱스를 사용할 것을 추천합니다. 

아래 표는 Neo4j의 각 버전에서 이용가능한 네이티브 인덱스 지원 정보가 나열되어 있습니다. 

| Neo4j 버전 | 네이티브 인덱싱에서 지원하는 값 종류 |
| ---------- | ------------------------------------ |
| 3.3 이전   | 이용 불가                            |
| 3.3        | 숫자                                 |
| 3.4        | 숫자, 문자열, 공간 값,  시간 값      |

### 9.2.2. 인덱스 제공자 

새 인덱스를 생성할 때 사용되는 인덱스 제공자 [dbms.index.default_schema_provider](https://neo4j.com/docs/operations-manual/3.4/reference/configuration-settings)를 설정하여 사용할 수 있습니다.  

명시적으로 설정하지 않으면`dbms.index.default_schema_provider`는 특정 버전의 Neo4j에서 가능한 가장 최신 제공자를 사용하도록 기본 값이 설정됩니다.

아래 표는 특정 Neo4j 버전에서 사용할 수 있는 최신 공급자 및 네이티브 인덱스 지원을 나타냅니다. 

| 설정 값             | 네이티브 인덱싱에서 지원하는 값 종류 |
| ------------------- | ------------------------------------ |
| `lucene-1.0`        | 공간 값, 임시 값                     |
| `lucene+native-1.0` | 공간 값, 임시 값, 숫자               |
| `lucene+native-2.0` | 공간 값, 임시 값, 숫자, 문자열       |


### 9.2.3. 3.4에서 문자열 인덱스의 한계 

일반적으로 최신 인덱스 제공자 버전은 최고의 성능을 제공합니다. 그러나, 3.4에서 네이티브 문자열 인덱스는 특별한 조작을 필요로하는 몇 가지 제한 사항이 있습니다. 

3.4에서 네이티브 문자열은 문자열 별로 길이가 4039 바이트로 제한되어 있습니다. 트랜잭션이 하나 이상의 변경 제한에 도달하면 변경사항을 커밋하기 전에 트랜잭션이 실패합니다. 
 
글자, 숫자 및 일부 기호와 같은 일반 문자 당 1 바이트로 변환되는 것에 주목해야 합니다. 라틴어가 아닌 문자, 이모티콘 및 다른 기호는 문자 별로 한 바이트 이상을 차지합니다. 그러므로, 만약 멀티-바이트 문자를 포함할 경우에 4039 문자 또는 그 이하를 포함하는 문자열은 4039 바이트 보다 길 것 입니다. 
 

3.4에서 네이티브 문자열 인덱스 또한 ```ENDS WITH``` 및 ```CONTAINS``` 쿼리에서 제한된 지원을 합니다. 그렇게 때문에 ```STARTS WITH```, ```=``` 및  ```<>```을 사용하는 쿼리에서 최적화된 검색을할 수 없습니다. 대신 색인 결과는 필터링 된 인덱스 스캔 스트림입니다. 실행 계획 관련 자세한 내용은 [섹션 3.7, 실행 계획”](https://neo4j.com/docs/developer-manual/3.4/cypher/execution-plans/)을 참조하십시오. 문자열 연산과 관련된 상세한 내용은 [섹션 운영-개발자 ] 문자열 연산자에 대한 자세한 내용은 [3.2.7.5 절. "비교 연산자"](https://neo4j.com/docs/developer-manual/3.4/cypher/syntax/operators/)를 참조하십시오.
 

만약 이 중에서 한계가 문제가 된다면, 인덱스 제공자를 제 2의 해결 방법은 해당 특정 인덱스에 Lucene을 사용하는 인덱스 공급자를 지정하는 것입니다.

이것은 아래 메소드를 사용해서 해결이 가능합니다. 

- 옵션 1; 설정 변경

  1. 필요한 곳에 ```dbms.index.default_schema_provider``` 설정 
  2. Neo4j 재시작. 
  3. 적절한 인덱스 삭제 및 재생성. 
  4. ```dbms.index.default_schema_provider```을 기존 값으로 변경. 
  5. Neo4j 재시작.

- 옵션 2; 내장된 프로시저 사용 

색인 작성, 고유 특성 제한 조건 작성 및 노드 키 작성 (Enterprise 전용)에 색인 제공자를 지정할 때 사용할 수 있는 내장 프로시저가 있습니다. 더 많은 정보는, [내장 프로시저](https://neo4j.com/docs/operations-manual/3.4/reference/procedures/)에서 확인할 수 있습니다. 

### 9.2.4. 업그레이드 고려사항 

인덱스를 생성할 때, 현재 인덱스 공급자가 할당되고 해당 인덱스가 삭제 될 때까지 인덱스에 남아 있습니다. 그러므로 Neo4j를 새 버전으로 업그레이드할 때, 향상된 색인 생성 기능을 활용하도록 이미 있는 인덱스는 삭제 및 재생성 해야합니다.

인덱스 캐싱은 여러 인덱스 공급자에 대해 서로 다른 메모리 영역에서 수행됩니다. 인덱스를 재생성하기 전, 후에 ```neo4j-admin memrec --database```을 사용하고 메모리 설정을 결과에 따라 조정하는 것은 유용합니다.   