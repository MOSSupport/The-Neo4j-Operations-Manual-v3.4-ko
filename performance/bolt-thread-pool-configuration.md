## 9.4. 볼트(Bolt) 스레드 풀(pool) 구성 

```
이 섹션에서는 볼트 커넥터에 내장된 스레드 풀 인프라와 그 구성에 대해서 다룹니다. 
```
 
볼트 커넥터는 서버 쪽 스레드 풀에 의해 백업됩니다. 스레드 풀은 서버 시작 프로세스의 일부로 구성됩니다. 

### 9.4.1. 스레드 풀 작동 방식 

볼트 스레드 풀은 최소 및 최대 용량이 있습니다. 이용 가능한 최소 스레드 양으로 시작되며 작업량에 따라 최대로 증가합니다. 지정된 시간보다 오래 존재하는 스레드는 자원을 확보하기 위해서 풀에서 멈추거나 제거됩니다. 그러나, 풀 사이즈는 절대 최소 값 이하로 떨어지지 않습니다. 설정된 각 연결은 커넥터의 스레드 풀에 할당됩니다. 가동되지 않는 커넥션은 서버의 리소스를 사용하지 않으며, 클라이언트에서 전송된 메세지를 모니터링 합니다. 

볼트 스레드 풀에 할당된 기본 값은 대부분 작업량에 적합하므로 커넥션 풀을 명시적으로 설정할 필요가 없습니다. 만약, 최대 풀 사이즈가 너무 낮게 설정하면 이용가능한 스레드가 없다는 에러 메시지와 함께 예외가 발생합니다. 또한, 이 메시지는 neo4j.log.에 기록됩니다. 


명시적으로 활성화되거나 암시적 트랜잭션을 사용하는 모든 커넥션은 트랜잭션을 시작하는 스레드에 고정되며, 트랜잭션이 닫힐 때까지 해당 스레드를 풀(pool)로 반환하지 않습니다.


### 9.4.2. 구성 옵션

볼트 커넥터를 구성할 때 아래 옵션을 사용합니다. 

**표 9.2. 스레드 풀 옵션**

| 옵션명                   | 기본 값 | 설명                                                         |
| ------------------------ | ------- | ------------------------------------------------------------ |
| `thread_pool_min_size`   | `5`     | 작동되지 않더라도 항상 가동되는 최소 스레드 수 입니다.       |
| `thread_pool_max_size`   | `400`   | 스레드 풀에서 생성되는 최대 스레드 개수 입니다.              |
| `thread_pool_keep_alive` | `5m`    | 풀에서 작동되지 않는 스레드를  제거하기 전에 스레드 풀이 대기하는 기간입니다.  스레드 수는 절대  ```thread_pool_min_size```이하로 떨어지지 않습니다. |


### 9.4.3. 볼트 스레드 풀 사이즈 조정 방법

작업량을 기반으로 스레트 풀 사이즈 값을 선택합니다. 활성화된 각 트랜잭션은 트랜잭션이 닫히기 전까지 풀에서 스레드를 사용하므로, 기본적으로 풀 구성 옵션의 값을 결정하는 최소 및 최대 활성 트랜잭션 입니다. 데이터베이스의 모니터링 기능 ([8 장 Monitoring](/monitoring.md) 참조)을 사용하여 작업 부하 관련 정보를 얻을 수 있습니다.

최소 또는 평균 작업량을 기반으로 ```thread_pool_min_size```을 설정합니다. 스레드 풀에는 항상 많은 양의 스레드가 있으므로 하위 값을 지정하면 작업 제출을 기다리는 많은 유휴 스레드를 갖는 것보다 자원 친화적일 수 있습니다.

최대 작업량을 기반으로 ```thread_pool_max_size```을 설정합니다. 기본적으로 이 값은 서버에서 예상되는 최대 활성 트랜잭션 수 후에 설정해야합니다. 또한, 클라이언트의 커넥션 및 단절 스레드 풀에서 작동하는 트랜잭션이 아닌 작업도 고려해야 합니다. 

**예시 9.4. 볼트 커텍터를 위한 스레드 풀 구성**

이 예에서 우리는 볼트 스레드 풀 최소 사이즈를 ```5```로 설정하며, 최대 사이즈는 ```100```으로 설정합니다. 그리고 10분 동안 유지시킵니다. 

```
dbms.connector.bolt.thread_pool_min_size=10
dbms.connector.bolt.thread_pool_max_size=100
dbms.connector.bolt.thread_pool_keep_alive=10m
```

